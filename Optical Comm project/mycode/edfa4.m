function pdot=edfa4(l,pp)
r=5e-06;
gammap=0.4;
gammas=0.8;
N=1e25;
A=pi.*r^2;
lamdap=1480e-09;
segmaep=0.7899e-25;
segmaap=1.950e-25;
lamdak=[1525 1530 1535 1540 1545 1550 1555 1560 1565]*10^-09;
segmaek=[3.983 4.752 4.147 3.416 3.24 3.084 2.945 2.773 2.353]*10^-25;
segmaak=[4.538 4.613 3.298 2.853 2.57 2.277 1.960 1.676 1.286]*10^-25;
%PsindB=0;
%Ps=10.^(PsindB/10).*10^-3;
%Pp=0.5;
t=10e-03;
c=3e8;
h=6.626e-34;
deltalamda=0.1e-09;
[segamaek,indexe] = unique(segmaek);
[segamaak,indexa] = unique(segmaak);
lamda=(1525:1:1565)*10^-9;
segmae=interp1(lamdak,segamaek(indexe),lamda,'spline');
segmaa=interp1(lamdak,segamaak(indexa),lamda,'spline');
lamdaT=lamda;
segmaeT=segmae;
segmaaT=segmaa;
con0=gammap.*lamdap.*segmaep;
con1=gammas.*sum(lamdaT.*segmaeT);
con2=gammas.*sum(lamdaT.*segmaaT);
%con2=gammas.*Ps.*sum(lamdaT.*segmaeT);
Pp=0.5;
PsindB=0;
Ps=(10.^(PsindB/10)).*10^-3;
const0=(con0)/(A*h*c);
const1=(con1)/(A*h*c);
const2=(con2)/(A*h*c);
N2=(const2.*Ps.*N)/((1/t)+(const0.*Pp)+(const1.*Ps)+(const2.*Ps));
N1=N-N2;
pdot(1)=(gammap.*((segmaep.*N2-segmaap.*N1)*pp(1)+...
        (2*h*c^2*segmaep.*N2.*deltalamda)/lamdap));
end
